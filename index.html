<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to URL Encoder</title>
    <link rel="stylesheet" href="style.css">
    <!-- 
      Using 'defer' ensures these scripts execute in order after the document is parsed,
      but before DOMContentLoaded is fired. This guarantees that 'config' and 'SystemManager'
      are available when the inline script runs.
    -->
    <script src="config.js" defer></script>
    <script src="SystemManager.js" defer></script>
</head>
<body>
    <div class="container">
        <h1>Image to URL Encoder</h1>
        <p>Select an image to encode it into a shareable URL.</p>

        <div id="image-upload-section">
            <input type="file" id="image-input" accept="image/*">
            <label for="image-input" class="file-label">Choose Image</label>
        </div>

        <div id="progress-section" class="hidden">
            <p id="status-message">Processing...</p>
            <progress id="progress-bar" value="0" max="100"></progress>
        </div>

        <div id="result-section" class="hidden">
            <h2>Generated URL:</h2>
            <textarea id="result-url" readonly></textarea>
            <button id="copy-button">Copy URL</button>
        </div>

        <div id="image-preview-container">
            <img id="image-preview" src="#" alt="Image Preview" class="hidden"/>
        </div>
    </div>

    <!-- 
      This script now reliably runs after config.js and SystemManager.js
      have been executed, preventing any race condition errors.
    -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize the system. This will handle loading all other scripts.
                await SystemManager.initialize(config);
            } catch (error) {
                console.error("Fatal error during system initialization:", error);
                // Display a user-friendly error message on the page as a fallback.
                document.body.innerHTML = '<div style="text-align: center; padding: 2rem;"><h1>Application Error</h1><p>Could not start the application. Please see the browser console for more details.</p></div>';
            }
        });
    </script>
</body>
</html>
